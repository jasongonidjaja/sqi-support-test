{"ast":null,"code":"import { Op } from \"sequelize\";\nimport { DeploymentRequest, DeploymentSupport, Application } from \"../models/index.js\";\nexport const getCalendarData = async (req, res) => {\n  try {\n    let {\n      weekStart,\n      weekEnd\n    } = req.query;\n    if (!weekStart || !weekEnd) {\n      return res.status(400).json({\n        error: \"Parameter weekStart dan weekEnd wajib diisi\"\n      });\n    }\n    const whereClause = {\n      implementDate: {\n        [Op.between]: [weekStart, weekEnd]\n      }\n    };\n    const [requests, supports] = await Promise.all([DeploymentRequest.findAll({\n      where: whereClause,\n      include: [{\n        model: Application,\n        as: \"application\",\n        attributes: [\"id\", \"name\"]\n      }],\n      order: [[\"implementDate\", \"ASC\"]]\n    }), DeploymentSupport.findAll({\n      where: whereClause,\n      order: [[\"implementDate\", \"ASC\"]]\n    })]);\n    const combined = [...requests.map(r => {\n      var _r$application;\n      return {\n        id: r.id,\n        type: \"request\",\n        title: r.title,\n        implementDate: r.implementDate,\n        applicationName: ((_r$application = r.application) === null || _r$application === void 0 ? void 0 : _r$application.name) || null,\n        riskImpact: r.riskImpact,\n        attachment: r.attachment,\n        status: r.status,\n        sqiPicId: r.sqiPicId\n      };\n    }), ...supports.map(s => ({\n      id: s.id,\n      type: \"support\",\n      title: s.title,\n      implementDate: s.implementDate,\n      applicationName: s.application || s.impactedApplication || null,\n      riskImpact: s.riskImpact,\n      attachment: s.attachment,\n      status: s.status,\n      sqiPicId: s.sqiPicId\n    }))].sort((a, b) => new Date(a.implementDate) - new Date(b.implementDate));\n    res.json({\n      message: \"✅ Calendar data loaded\",\n      weekStart,\n      weekEnd,\n      total: combined.length,\n      count: combined.length,\n      data: combined\n    });\n  } catch (err) {\n    console.error(\"❌ Error in getCalendarData:\", err);\n    res.status(500).json({\n      error: \"Gagal memuat data kalender\"\n    });\n  }\n};","map":{"version":3,"names":["Op","DeploymentRequest","DeploymentSupport","Application","getCalendarData","req","res","weekStart","weekEnd","query","status","json","error","whereClause","implementDate","between","requests","supports","Promise","all","findAll","where","include","model","as","attributes","order","combined","map","r","_r$application","id","type","title","applicationName","application","name","riskImpact","attachment","sqiPicId","s","impactedApplication","sort","a","b","Date","message","total","length","count","data","err","console"],"sources":["C:/Users/jason/Desktop/Projects/sqi-support-app-cts-e/frontend/src/pages/DeploymentBoardPage.js"],"sourcesContent":["import { Op } from \"sequelize\";\r\nimport { DeploymentRequest, DeploymentSupport, Application } from \"../models/index.js\";\r\n\r\nexport const getCalendarData = async (req, res) => {\r\n  try {\r\n    let { weekStart, weekEnd } = req.query;\r\n\r\n    if (!weekStart || !weekEnd) {\r\n      return res.status(400).json({\r\n        error: \"Parameter weekStart dan weekEnd wajib diisi\",\r\n      });\r\n    }\r\n\r\n    const whereClause = {\r\n      implementDate: { [Op.between]: [weekStart, weekEnd] },\r\n    };\r\n\r\n    const [requests, supports] = await Promise.all([\r\n      DeploymentRequest.findAll({\r\n        where: whereClause,\r\n        include: [\r\n          {\r\n            model: Application,\r\n            as: \"application\",\r\n            attributes: [\"id\", \"name\"],\r\n          },\r\n        ],\r\n        order: [[\"implementDate\", \"ASC\"]],\r\n      }),\r\n      DeploymentSupport.findAll({\r\n        where: whereClause,\r\n        order: [[\"implementDate\", \"ASC\"]],\r\n      }),\r\n    ]);\r\n\r\n    const combined = [\r\n      ...requests.map((r) => ({\r\n        id: r.id,\r\n        type: \"request\",\r\n        title: r.title,\r\n        implementDate: r.implementDate,\r\n        applicationName: r.application?.name || null,\r\n        riskImpact: r.riskImpact,\r\n        attachment: r.attachment,\r\n        status: r.status,\r\n        sqiPicId: r.sqiPicId,\r\n      })),\r\n      ...supports.map((s) => ({\r\n        id: s.id,\r\n        type: \"support\",\r\n        title: s.title,\r\n        implementDate: s.implementDate,\r\n        applicationName: s.application || s.impactedApplication || null,\r\n        riskImpact: s.riskImpact,\r\n        attachment: s.attachment,\r\n        status: s.status,\r\n        sqiPicId: s.sqiPicId,\r\n      })),\r\n    ].sort((a, b) => new Date(a.implementDate) - new Date(b.implementDate));\r\n\r\n    res.json({\r\n      message: \"✅ Calendar data loaded\",\r\n      weekStart,\r\n      weekEnd,\r\n      total: combined.length,\r\n      count: combined.length,\r\n      data: combined,\r\n    });\r\n  } catch (err) {\r\n    console.error(\"❌ Error in getCalendarData:\", err);\r\n    res.status(500).json({ error: \"Gagal memuat data kalender\" });\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}